<!DOCTYPE html>
<html>
<head>
    <title>Critical System Alert</title>
    <style>
        /* Styles for the programmer/system look */
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Courier New', monospace; text-align: center; padding-top: 50px; }
        #initial-message, #proposal-form { margin: 30px; }
        .role { color: #a371f7; font-weight: bold; }
        #reveal-button, button[type="submit"] { 
            background-color: #238636; /* GitHub Green */
            color: white; border: none; padding: 10px 20px; font-size: 18px; 
            cursor: pointer; border-radius: 6px; margin: 5px; 
        }
        #proposal-form { display: none; } 
        .response-button:hover { opacity: 0.9; }
        #success-message { color: #238636; margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="initial-message">
        <h1>SYSTEM ERROR: REQUIRED ASSETS MISSING</h1>
        <p>Dependency Bman and Jenica's-Wedding/core/entourage.js failed to load.</p>
        <p><strong>You</strong> are the only one who can patch this.</p>
        <button id="reveal-button" onclick="startPatch()">RUN DEBUGGER</button>
    </div>
    
    <form id="proposal-form" action="https://formspree.io/f/mpwybyar" method="POST">
        <h1 id="greeting"></h1>
        <p>Will you be my <span class="role"></span> on **January 12th**?</p>
        <p>Please confirm your acceptance below:</p>

        <input type="hidden" name="name" id="hidden-name-field" value="">
        <input type="hidden" name="date" value="January 12">
        <input type="hidden" name="_subject" id="subject-field" value="Groomsman Proposal Accepted!">

        <button type="submit" name="response" value="Yes" class="response-button">Yes</button>
        <button type="submit" name="response" value="Of Course" class="response-button">Of Course</button>

        <p id="success-message" style="display: none;">**Transmission Confirmed.** Details will follow. Thanks, friend!</p>
    </form>

   <script>
    // --- Role Code Dictionary ---
    const ROLE_DICTIONARY = {
        'gm': 'Groomsman',
        'bm': 'Best Man',
        'us': 'Usher',
        // Add other roles here if needed (e.g., 'bs' for Bridesman)
    };
    // ----------------------------

    // Get the parameters from the current URL
    const urlParams = new URLSearchParams(window.location.search);
    const FRIEND_NAME = urlParams.get('name') || 'Friend';
    const FRIEND_ROLE_CODE = urlParams.get('role') || 'gm'; 

    // Translate the code into the full, display name
    const FRIEND_ROLE = ROLE_DICTIONARY[FRIEND_ROLE_CODE] || 'Groomsman'; 

    function startPatch() {
        // 1. Hide initial message and show the form
        document.getElementById('initial-message').style.display = 'none';
        document.getElementById('proposal-form').style.display = 'block';

        // 2. Personalize the elements using the data pulled from the URL
        const greeting = document.getElementById('greeting');
        const roleSpan = document.querySelector('#proposal-form .role');
        const hiddenNameField = document.getElementById('hidden-name-field');
        const subjectField = document.getElementById('subject-field');
        
        greeting.innerHTML = `Hi, <span class="role">${FRIEND_NAME}</span>!`;
        roleSpan.innerHTML = FRIEND_ROLE; // Displays the full name (e.g., "Best Man")
        hiddenNameField.value = FRIEND_NAME;
        
        // Sets the email subject for confirmation
        subjectField.value = `${FRIEND_ROLE} Proposal Accepted by ${FRIEND_NAME}`;
    }
    
    // This handles the form submission to Formspree
    document.getElementById('proposal-form').addEventListener("submit", async function (event) {
        event.preventDefault();
        const form = event.target;
        const data = new FormData(form);
        
        // Send the data to Formspree
        await fetch(form.action, {
            method: form.method,
            body: data,
            headers: { 'Accept': 'application/json' }
        });

        // Show the success message and hide the buttons
        document.getElementById('proposal-form').querySelector('p:last-child').style.display = 'none';
        document.getElementById('proposal-form').querySelectorAll('.response-button').forEach(btn => btn.style.display = 'none');
        document.getElementById('success-message').style.display = 'block';
    });
</script>

</body>
</html>



